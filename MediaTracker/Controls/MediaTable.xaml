<UserControl x:Class="MediaTracker.MediaTable"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:con="http://schemas.kent.boogaart.com/converters"
             xmlns:controls="clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Input.Toolkit"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             Width="Auto"
             Height="Auto"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Stretch"
             Loaded="DbControl_OnLoaded"
             d:DesignHeight="300"
             d:DesignWidth="300"
             mc:Ignorable="d">

    <Grid Width="Auto" HorizontalAlignment="Stretch">
        <!--  DataGrid control that shows the output from the database  -->
        <Grid>
            <DataGrid x:Name="DataGridItem"
                      Width="Auto"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      AlternationCount="2"
                      AutoGenerateColumns="True"
                      AutoGeneratedColumns="DbControl_TableGeneration"
                      AutoGeneratingColumn="DbControl_ColumnGeneration"
                      CanUserAddRows="False"
                      CanUserDeleteRows="True"
                      IsReadOnly="true"
                      ItemsSource="{Binding}"
                      MouseDoubleClick="DataGrid_MouseDoubleClick"
                      SelectionUnit="FullRow">

                <!--  Add button controls to DataGrid  -->
                <DataGrid.Columns>

                    <!--  Rating Column  -->
                    <DataGridTemplateColumn MinWidth="100"
                                            MaxWidth="100"
                                            Header="Score">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid>
                                    <controls:Rating x:Name="RatingScore"
                                                     VerticalAlignment="Center"
                                                     HorizontalContentAlignment="Stretch"
                                                     VerticalContentAlignment="Stretch"
                                                     Background="{x:Null}"
                                                     IsEnabled="True"
                                                     IsTabStop="False"
                                                     ItemCount="5"
                                                     Padding="0"
                                                     ValueChanged="RatingScore_OnValueChanged"
                                                     Value="{Binding Path=Rating}">
                                        <controls:Rating.ItemBindingGroup>
                                            <BindingGroup />
                                        </controls:Rating.ItemBindingGroup>
                                        <controls:Rating.Foreground>
                                            <LinearGradientBrush MappingMode="RelativeToBoundingBox" StartPoint="0.5,0" EndPoint="0.5,1">
                                                <GradientStop Offset="1" Color="#FF383429" />
                                                <GradientStop Offset="0.877" Color="#FF99902A" />
                                                <GradientStop Offset="0.755" Color="#FFACA017" />
                                                <GradientStop Offset="0.545" Color="#FFF7F100" />
                                            </LinearGradientBrush>
                                        </controls:Rating.Foreground>
                                    </controls:Rating>
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>


                    <!--  Increment/Decrement button  -->
                    <DataGridTemplateColumn MinWidth="100"
                                            MaxWidth="150"
                                            CanUserResize="False"
                                            Header="Progress">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid Margin="1,0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="0" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="18" />
                                        <ColumnDefinition Width="18" />
                                        <ColumnDefinition Width="0" />
                                    </Grid.ColumnDefinitions>
                                    <!--  Assign the columns for the custom control  -->
                                    <TextBox Grid.Row="1"
                                             Grid.Column="1"
                                             Height="22"
                                             MinHeight="0"
                                             Margin="5,0,2,0"
                                             HorizontalContentAlignment="Right"
                                             VerticalContentAlignment="Center"
                                             FontSize="11"
                                             IsReadOnly="True"
                                             Text="{Binding Path=itemprogress,
                                                            StringFormat={}{0} eps}"
                                             TextWrapping="Wrap" />
                                    <!--  Increment button  -->
                                    <Button Grid.Row="1"
                                            Grid.Column="2"
                                            MinHeight="20"
                                            MaxHeight="20"
                                            Margin="0,0,1,0"
                                            Click="UpdateProgress"
                                            CommandParameter="{Binding Path=Title}"
                                            Tag="Decrement">
                                        <TextBlock Height="20"
                                                   MinWidth="20"
                                                   MinHeight="20"
                                                   MaxWidth="20"
                                                   MaxHeight="20"
                                                   Margin="0,-10,-9,0"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   FontSize="18"
                                                   Text="▾" />
                                    </Button>

                                    <Button Grid.Row="1"
                                            Grid.Column="3"
                                            MinHeight="20"
                                            MaxHeight="20"
                                            Margin="0"
                                            Click="UpdateProgress"
                                            CommandParameter="{Binding Path=Title}"
                                            Tag="Increment">
                                        <TextBlock Height="20"
                                                   MinWidth="20"
                                                   MinHeight="20"
                                                   MaxWidth="20"
                                                   MaxHeight="20"
                                                   Margin="0,-10,-9,0"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   FontSize="18"
                                                   Text="▴" />
                                    </Button>
                                    <!--  Decrement button  -->
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Width="60"
                                            CanUserResize="False"
                                            Header="Status">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>

                                <ComboBox Width="auto"
                                          Height="auto"
                                          Margin="0"
                                          HorizontalContentAlignment="Stretch"
                                          VerticalContentAlignment="Stretch"
                                          Padding="5,0,0,0"
                                          SelectedIndex="{Binding Path=statusid}"
                                          SelectionChanged="Selector_OnSelectionChanged">

                                    <ComboBoxItem Name="Complete" Padding="5">
                                        <StackPanel Orientation="Horizontal">
                                            <Rectangle Width="15"
                                                       Height="15"
                                                       HorizontalAlignment="Left"
                                                       Fill="Green">
                                                <Rectangle.OpacityMask>
                                                    <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_location_circle}" />
                                                </Rectangle.OpacityMask>
                                            </Rectangle>
                                            <TextBlock Margin="10,0,0,0" Text="Complete" />
                                        </StackPanel>
                                    </ComboBoxItem>

                                    <ComboBoxItem Name="Ongoing" Padding="5">
                                        <StackPanel Orientation="Horizontal">
                                            <Rectangle Width="15"
                                                       Height="15"
                                                       HorizontalAlignment="Left"
                                                       Fill="Yellow">
                                                <Rectangle.OpacityMask>
                                                    <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_location_circle}" />
                                                </Rectangle.OpacityMask>

                                            </Rectangle>
                                            <TextBlock Margin="10,0,0,0" Text="Ongoing" />
                                        </StackPanel>
                                    </ComboBoxItem>

                                    <ComboBoxItem Name="Dropped" Padding="5">
                                        <StackPanel Orientation="Horizontal">
                                            <Rectangle Width="15"
                                                       Height="15"
                                                       HorizontalAlignment="Left"
                                                       Fill="Red">

                                                <Rectangle.OpacityMask>
                                                    <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_location_circle}" />
                                                </Rectangle.OpacityMask>

                                            </Rectangle>
                                            <TextBlock Margin="10,0,0,0" Text="Dropped" />
                                        </StackPanel>
                                    </ComboBoxItem>




                                    <ComboBoxItem Name="Planned" Padding="5">
                                        <StackPanel Orientation="Horizontal">
                                            <Rectangle Width="15"
                                                       Height="15"
                                                       HorizontalAlignment="Left"
                                                       Fill="Gray">

                                                <Rectangle.OpacityMask>
                                                    <VisualBrush Stretch="Fill" Visual="{StaticResource appbar_location_circle}" />
                                                </Rectangle.OpacityMask>

                                            </Rectangle>
                                            <TextBlock Margin="10,0,0,0" Text="Planned" />
                                        </StackPanel>
                                    </ComboBoxItem>

                                </ComboBox>

                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!--  Delete button  -->
                    <DataGridTemplateColumn Width="30"
                                            CanUserResize="False"
                                            Header="X">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Click="RemoveItem"
                                        CommandParameter="{Binding Path=Title}"
                                        Content="✘"
                                        Tag="{Binding}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                </DataGrid.Columns>

                <DataGrid.Resources>
                    <!--  Style to allow long texts in table to wrap  -->
                    <Style x:Key="WordWrapStyle" TargetType="{x:Type TextBlock}">
                        <Setter Property="TextWrapping" Value="Wrap" />
                    </Style>

                    <!--  Test  -->
                    <Style x:Key="TestStyle" TargetType="{x:Type TextBox}" />
                </DataGrid.Resources>

                <!--  Odd rows will have different background colour  -->
                <DataGrid.Style>
                    <Style BasedOn="{StaticResource {x:Type DataGrid}}" TargetType="DataGrid">
                        <Setter Property="AlternatingRowBackground" Value="{DynamicResource MenuItemSelectionFill}" />
                    </Style>
                </DataGrid.Style>


            </DataGrid>
        </Grid>
    </Grid>
</UserControl>